# Recipe: Agent Skills Support

This recipe adds support for the
[Agent Skills](https://agentskills.io) format by building a custom
`lectic skills` subcommand.

## What are Agent Skills?

[Agent Skills](https://agentskills.io) is an open format for packaging
reusable capabilities that LLMs can load on demand. A skill is a folder
containing:

- `SKILL.md`: Instructions for the LLM (with YAML frontmatter for metadata)
- `scripts/`: Executable scripts the LLM can run
- `references/`: Documentation and examples the LLM can read

The format emphasizes "progressive disclosure"â€”the LLM sees only skill
names and descriptions initially, then loads full instructions only when
needed. This keeps prompts small while giving the LLM access to a large
library of capabilities.

## Goal

We'll build a subcommand that gives your LLM access to a library of skills
while keeping the base prompt small. It follows the skills spec's
"progressive disclosure" approach:

1. Discovery: load only each skill's name + description.
2. Activation: load the full `SKILL.md` instructions for one skill.
3. Resources: read reference files or run scripts only when needed.

## The subcommand

Lectic resolves `lectic <command>` using git-style subcommands. We will create
an executable named `lectic-skills.ts` (TypeScript), using Lectic's built-in
script interpreter.

Copy the repository's `extra/lectic-skills.ts` to your config directory:

```bash
cp /path/to/lectic/extra/lectic-skills.ts ~/.config/lectic/lectic-skills.ts
chmod +x ~/.config/lectic/lectic-skills.ts
```

Now `lectic skills` should resolve to that file.

## Skill directories

The subcommand accepts one or more "skill directory" paths.

Each path may be either:

- A single skill root (it contains `SKILL.md`)
- A directory that contains multiple skill roots as immediate children

Example layout:

```text
skills/
  pdf-processing/
    SKILL.md
    scripts/
    references/
  code-review/
    SKILL.md
```

## Configure it as an exec tool

Add an exec tool that bakes in the skill directories:

```yaml
tools:
  - name: skills
    exec: lectic skills ./skills $LECTIC_DATA/skills
    usage: exec:lectic skills --prompt ./skills $LECTIC_DATA/skills
```

This creates a single tool (named `skills`) that the model can use to:

- `activate <name>` (load instructions)
- `read <name> <path>` (load reference content)
- `run <name> <script> ...` (execute bundled scripts)

The discovery list (name + description for each skill) is included in the
tool usage text generated by `--prompt`, so the model usually does not need to
call `list`.

## Example workflow

1. The model activates a skill when relevant:

```text
<tool-call with="skills">
<arguments><argv>["activate","pdf-processing"]</argv></arguments>
...</tool-call>
```

3. It reads references mentioned by `SKILL.md`:

```text
<tool-call with="skills">
<arguments><argv>["read","pdf-processing","references/REFERENCE.md"]</argv></arguments>
...</tool-call>
```

4. It runs a script bundled with the skill:

```text
<tool-call with="skills">
<arguments><argv>["run","pdf-processing","extract.py","--input","a.pdf"]</argv></arguments>
...</tool-call>
```

## How it's built

The subcommand is a small CLI wrapper around the skills folder format:

- It scans the provided directories for `SKILL.md` files.
- It parses the YAML frontmatter to build the discovery list.
- `activate` returns the full skill instructions on demand.
- `read` enforces path containment (no `..` escapes) and has a size cap.
- `run` executes files in `scripts/` only, with the skill root as the working
  directory.

## Safety notes

Running skill scripts is equivalent to granting the LLM another `exec` tool.
In real use, you should combine this with one or more of:

- A `tool_use_pre` confirmation hook
- A sandbox wrapper (Bubblewrap, nsjail, etc.)

See [Custom Sandboxing](./06_custom_sandboxing.qmd) for practical options.
