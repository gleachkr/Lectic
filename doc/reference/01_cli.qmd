# Reference: Commandâ€‘Line Interface

The `lectic` command is the primary way to interact with Lectic. It can read
from a file or from standard input, and it offers flags to control how the
result is printed or saved.

## Usage

```bash
lectic [FLAGS] [OPTIONS] [SUBCOMMAND] [ARGS...]
```

## Subcommands

- `lectic lsp`
  Start the LSP server. Transport: stdio.

- `lectic parse`
  Parse a lectic file into a JSON representation of the parsed file
  structure. Useful for programmatic analysis and modification.

  Flags:
  - `--yaml`: Emit YAML instead of JSON.
  - `--reverse`: Ingest JSON (or YAML) output and reconstruct the original
    lectic file.

- `lectic models`
  List available models for providers with detected credentials.

  Providers with API keys in the environment are queried. The `codex`
  provider is listed if you have previously logged in (it is not an API
  key-based provider).

- `lectic script`
  Bundle and run a JS/TS/JSX/TSX module using Lectic's internal Bun
  runtime. Works as a hashbang interpreter, useful for writing
  subcommands (see below), [hooks](../automation/02_hooks.qmd), and
  [exec tools](../tools/02_exec.qmd).

  During bundling, Lectic supports explicit remote imports via
  `https://...` URLs (and `http://` for localhost only), in order to easily
  support writing self-contained single-file scripts.

  For TSX/JSX scripts using React's automatic runtime, include an explicit
  `import React from "https://..."` so Lectic can resolve the implicit
  `react/jsx-runtime` / `react/jsx-dev-runtime` imports.

  Bundled output is cached on disk under `$LECTIC_CACHE/scripts/`.
  The cache key includes the script contents, the Bun version, and an
  internal plugin version. Delete that directory to force a re-bundle.

  Note: remote imports are treated as pinned by URL. Changes on the
  remote server will not invalidate the cache automatically.

  Prefer versioned URLs so builds are reproducible. For example, when
  using esm.sh, import `react@18.3.1` instead of `react`:

  `import React from "https://esm.sh/react@18.3.1"`

  For example:

  ```bash
  #!/bin/env -S lectic script
  console.log("Hello from a lectic script!")
  ```

- `lectic a2a`
  Start an A2A (JSON-RPC + SSE) server exposing configured agents.

  Options:
  - `--root <path>`: Workspace root (process.chdir to this path).
  - `--host <host>`: Bind host. Default: `127.0.0.1`.
  - `--port <port>`: Bind port. Default: `41240`.
  - `--token <token>`: If set, require `Authorization: Bearer <token>`.
  - `--max-tasks-per-context <n>`: Maximum number of task snapshots to
    keep in memory per contextId. Default: `50`.

  Monitoring endpoints (HTTP):

  Cross-agent:

  - `GET /monitor/agents`
    - Lists configured agents.
  - `GET /monitor/tasks`
    - Returns recent task snapshots across all agents.
    - Optional query: `?agentId=<id>&contextId=<id>`.
  - `GET /monitor/tasks/<taskId>`
    - Returns a single task snapshot, searching across all agents.
  - `GET /monitor/events`
    - Server-Sent Events stream of task lifecycle events.
    - Optional query: `?agentId=<id>&contextId=<id>`.

  Per-agent:

  - `GET /monitor/agents/<id>/tasks`
    - Returns recent task snapshots.
    - Optional query: `?contextId=<id>`.
  - `GET /monitor/agents/<id>/tasks/<taskId>`
    - Returns a single task snapshot.
  - `GET /monitor/agents/<id>/events`
    - Server-Sent Events stream of task lifecycle events.
    - Optional query: `?contextId=<id>`.

  If `--token` is set, the monitoring endpoints require
  `Authorization: Bearer <token>`.

## Custom Subcommands

Lectic supports git-style custom subcommands. If you invoke
`lectic <command>`, Lectic looks for an executable named
`lectic-<command>` in this order by default:

1. `$LECTIC_CONFIG` (searched recursively)
2. `$LECTIC_DATA` (searched recursively)
3. `$PATH` entries (top-level per entry)

If `LECTIC_RUNTIME` is set, Lectic uses that PATH-style directory list
for recursive discovery instead of `$LECTIC_CONFIG` and `$LECTIC_DATA`.

See [Custom Subcommands](../automation/03_custom_subcommands.qmd) for a full
guide on creating subcommands and adding tab completion for them.

## Bash completion

The repository includes a bash completion script. See
[Getting Started](../02_getting_started.qmd#tab-completion-optional) for
installation instructions.

The completion system is extensible. You can write plugins to provide
completions for your custom subcommands. See the
[Custom Subcommands](../automation/03_custom_subcommands.qmd#tab-completion)
guide for details.

## Flags and options

- `-v`, `--version`
  Prints the version string.

- `-f`, `--file <PATH>`
  Path to the conversation file (`.lec`) to process. If omitted, Lectic
  reads from standard input.

- `-i`, `--inplace <PATH>`
  Read from the given file and update it in place. Mutually exclusive with
  `--file`.

- `-s`, `--short`
  Only emit the newly generated assistant message, not the full updated
  conversation.

- `-S`, `--Short`
  Like `--short`, but emits only the raw message text (without the
  `:::Speaker` wrapper).

- `-l`, `--log <PATH>`
  Write detailed debug logs to the given file.

- `-q`, `--quiet`
  Suppress printing the assistant's response to stdout.

- `-h`, `--help`
  Show help for all flags and options.

## Constraints

- --inplace cannot be combined with --file.
- --quiet cannot be combined with --short or --Short.

## Common examples

- Generate the next message in a file and update it in place:
  ```bash
  lectic -i conversation.lec
  ```

- Read from stdin and write the full result to stdout:
  ```bash
  cat conversation.lec | lectic
  ```

- Stream just the new assistant message:
  ```bash
  lectic -s -f conversation.lec
  ```

- Add a message from the command line and update the file:
  ```bash
  echo "This is a new message." | lectic -i conversation.lec
  ```

- List available models for detected providers:
  ```bash
  lectic models
  ```

- Start the LSP server (stdio transport):
  ```bash
  lectic lsp
  ```

- Parse a file to JSON:
  ```bash
  lectic parse -f conversation.lec
  ```

- Round-trip a file through parsing and reconstruction:
  ```bash
  lectic parse -f conversation.lec | lectic parse --reverse
  ```
